<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gemini 2.5 Flash Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; cursor: pointer; }
        .status { margin: 10px 0; padding: 5px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #cce7ff; color: #004085; }
        textarea { width: 100%; margin: 5px 0; }
        select { width: 100%; padding: 5px; margin: 5px 0; }
    </style>
</head>
<body>
    <h3>Gemini 2.5 Flash Test - UPDATED WITH ENHANCED LOGGING</h3>
    <textarea id="promptInput" rows="5" placeholder="Enter your prompt...">hi, this is a test of your API, give 1 sentence response please.</textarea>
    <button onclick="submitPrompt()" style="background: #4285f4; color: white;">Submit to Gemini</button>
    <button onclick="clearResponse()">Clear Response</button>
    <div id="timer" style="font-weight: bold; margin: 10px 0; color: #333;"></div>
    <div id="status" class="status" style="display: none;"></div>
    <h4>Response:</h4>
    <textarea id="responseOutput" rows="15" placeholder="Gemini response will appear here..." readonly></textarea>
    
    <script>
        let requestStartTime = 0;
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }

        async function submitPrompt() {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) return showStatus('Please enter a prompt', 'error');

            console.log('=== CLIENT: Submitting prompt ===');
            console.log('Prompt:', prompt);

            // Start timer
            requestStartTime = performance.now();
            document.getElementById('timer').textContent = 'Timer: Sending request to Gemini...';
            showStatus('Processing prompt...', 'info');
            
            // Clear previous response
            document.getElementById('responseOutput').value = '';

            try {
                console.log('CLIENT: Sending POST request to /api/gemini');
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });

                console.log('CLIENT: Response status:', response.status);
                console.log('CLIENT: Response headers:', response.headers);

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('CLIENT: Error response:', errorData);
                    throw new Error(`API Error: ${response.status} - ${errorData.error || 'Unknown error'}`);
                }

                const data = await response.json();
                console.log('CLIENT: Success response:', data);
                
                const responseTime = Math.round(performance.now() - requestStartTime);
                document.getElementById('timer').textContent = `Timer: ${responseTime}ms to receive response`;
                
                document.getElementById('responseOutput').value = data.response || 'No response received';
                showStatus('Response received successfully!', 'success');
                
            } catch (error) {
                console.error('CLIENT: Caught error:', error);
                showStatus(`Error: ${error.message}`, 'error');
                document.getElementById('timer').textContent = 'Timer: Request failed';
                
                // Display detailed error in response area
                document.getElementById('responseOutput').value = `Error Details:\n${error.message}\n\nCheck browser console for more details.`;
            }
        }

        function clearResponse() {
            document.getElementById('responseOutput').value = '';
            document.getElementById('timer').textContent = '';
            document.getElementById('status').style.display = 'none';
        }
    </script>
</body>
</html>